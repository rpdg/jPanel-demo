var x$=function(){"use strict";function e(e,t){return Array.prototype.slice.call((t||document).querySelectorAll(e))}const t=function(e){return document.getElementById(e)},n=function(e,t){e.classList.remove(t)},i=function(e,t){e.classList.add(t)};let o=[],s=0,r=-1,l={};const a=function(e,t,n=!1){let i;return n?(i=--s,o.unshift(i)):(i=++r,o.push(i)),l[i]=t,i},h=function(e){let t=!1,n=o;for(let i=0,o=n.length;i<o;i++)if(n[i]==e){n.splice(i,1),delete l[e],t=!0;break}return t};document.onkeydown=function(e){let t=l,n=o.slice();for(let i=0,o=n.length;i<o;i++){let o=t[n[i]].call(window,e);if(!1===o)return o}};var c=Object.freeze({__proto__:null,select:e,probe:function(){let e=document.body;e.classList||console.warn("classList not supported"),e.querySelectorAll||console.warn("querySelectorAll not supported"),e.getBoundingClientRect||console.warn("getBoundingClientRect not supported"),window.getComputedStyle||console.warn("window.getComputedStyle not supported")},byId:t,byClass:function(e,t){return(t||document).getElementsByClassName(e)},byTag:function(e,t){return(t||document).getElementsByTagName(e)},getBoundingClientRect:function(e){if(e.getBoundingClientRect)return e.getBoundingClientRect();let t=0,n=0,i=e.offsetWidth,o=e.offsetHeight;do{t+=e.offsetLeft,n+=e.offsetTop}while(e=e.offsetParent);return{left:Math.round(t),top:Math.round(n),width:i,height:o}},removeClass:n,addClass:i,toggleClass:function(e,t){return e.classList.contains(t)?n(e,t):i(e,t)},on:a,off:h,once:function(e,t,n){let i=a(0,(function(e){return h(i),i=null,t.call(window,e)}),n);return i}});const u={up:"up",down:"down",left:"left",right:"right",ok:"ok"},d={37:u.left,39:u.right,38:u.up,40:u.down,13:u.ok},p=window.navigator.userAgent,f=-1===p.indexOf("Windows; U;"),g=function(){let e,t={},n=window.location.search.replace(/^\?/,"").split("&"),i=n.length,o=0;for(;o<i;o++)n[o]&&(e=n[o].split("="),t[e[0]]=e[1]);return t}();var m=Object.freeze({__proto__:null,KEY_NAMES:u,KEY_CODE_MAPS:d,EMPTY_FUNC:()=>{},Browser:p,IsDesktop:f,Version:"0.21",request:g});let x=0;const y=function(){return++x};function b(e){return e instanceof Date||e instanceof RegExp}function v(e){if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);throw new Error("Unexpected situation")}const w=function(e){let t=[];return e.forEach((function(e,n){"object"==typeof e&&null!==e?Array.isArray(e)?t[n]=w(e):b(e)?t[n]=v(e):t[n]=j({},e):t[n]=e})),t};function I(e,t){return"__proto__"===t?void 0:e[t]}function j(e,...t){if(arguments.length<1||"object"!=typeof arguments[0])throw new Error("no object to deep extend.");if(arguments.length<2)return j({},arguments[0]);let n,i,o=e;return t.forEach((function(e){"object"!=typeof e||null===e||Array.isArray(e)||Object.keys(e).forEach((function(t){return i=I(o,t),n=I(e,t),n===o?void 0:"object"!=typeof n||null===n?void(o[t]=n):Array.isArray(n)?void(o[t]=w(n)):b(n)?void(o[t]=v(n)):"object"!=typeof i||null===i||Array.isArray(i)?void(o[t]=j({},n)):void(o[t]=j(i,n))}))})),o}const C=function(){let e=/\${(\w*[:]*[=]*\w+)\}(?!})/g;return function(t,n){return t.replace(e,(function(e,t,i){return n[t]}))}}(),T={Array:function(e){return"[object Array]"==Object.prototype.toString.call(e)},RegExp:function(e){return"[object RegExp]"==Object.prototype.toString.call(e)},Date:function(e){return"[object Date]"==Object.prototype.toString.call(e)},Number:function(e){return"[object Number]"==Object.prototype.toString.call(e)},String:function(e){return"[object String]"==Object.prototype.toString.call(e)},Object:function(e){return"[object Object]"==Object.prototype.toString.call(e)},HTMLDocument:function(e){return"[object HTMLDocument]"==Object.prototype.toString.call(e)},PlainObject:function(e){if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"==Object.prototype.toString.call(e)}return!1}},R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},S=function(e){return e.replace(/[&<>"']/g,(function(e){return R[e]}))},E={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},O=document.body.isEqualNode?"isEqualNode":"isSameNode";var B=Object.freeze({__proto__:null,componentUid:y,deepCloneArray:w,deepExtend:j,fastClone:function e(t,n){for(let i in n)t[i]=n[i]&&"object"==typeof n[i]?e(n[i].constructor(),n[i]):n[i];return t},formatJSON:C,Is:T,jsonPath:function(e,t){if(t){let n=`["${t.split(".").join('"]["')}"]`;return new Function("src","return src"+n)(e)}return e},htmlEncode:S,htmlDecode:function(e){return e.replace(/(&amp;|&lt;|&gt;|&quot;|&#39;)/g,(function(e){return E[e]}))},delegate:function(e,t,n,i){e.addEventListener(t,(function(t){let o=t.target;for(;o;)o[O](e)?o=void 0:o.classList.contains(n)?(i.call(o,t),o=void 0):o=o.parentNode}))},delay:function(e,t){return new Promise(t=>setTimeout(()=>{t()},e))}});const M="stop",k="loop",H="up",L="down",_="left",N="right",P="auto",D={edgeRule:{up:"stop",down:"stop",left:"stop",right:"stop"},forceRec:!1,keyMap:d,offset:{x:0,y:0}};class A{constructor(n,i){this.boxIndex=-1,this.previousIndex=-1,this.hoverTimer=0,this.hoverDelay=1e3,this.selector=n;let o=j({},D,i);this.name=i.name??"grid-"+y(),this.edgeRule=o.edgeRule,this.keyMap=o.keyMap,this.cols=o.cols??1,this.rows=o.rows??1,this.selectedIndex=o.selectedIndex??0,this.offset=o.offset,this.onFocus=o.onFocus&&o.onFocus.bind(this),this.onOk=o.onOk&&o.onOk.bind(this),this.onBlur=o.onBlur&&o.onBlur.bind(this),this.onBeforeChange=o.onBeforeChange&&o.onBeforeChange.bind(this),this.onChange=o.onChange&&o.onChange.bind(this),this.hoverClass=o.hoverClass,o.frameId&&(this.frame=t(o.frameId)),this.elems=e(n),i.forceRec instanceof Array?(this.matrix=i.forceRec,this.forceRec=!1):(this.matrix=[],this.forceRec=i.forceRec??!1,this.initMatrix()),this.length&&this.setIndex(this.selectedIndex,P)}focus(){this.frame&&(this.frame.style.display="block"),this.hoverClass&&i(this.selectedElement,this.hoverClass),this.onFocus&&this.onFocus.call(this)}blur(){this.frame&&(this.frame.style.display="none"),this.hoverClass&&n(this.selectedElement,this.hoverClass),this.onBlur&&this.onBlur.call(this)}reset(t,n){this.elems=e(this.selector),this.previousIndex=this.selectedIndex=-1,!isNaN(t)&&this.length&&this.setIndex(t,n||P)}setIndex(e,t){if(this.onBeforeChange&&this.onBeforeChange.call(this,t),e<0||e+1>this.length)this.overRange(t);else{this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=0),this.previousIndex=this.selectedIndex,this.selectedIndex=e;let o,s=this.frame;if(s){if(!this.matrix[e]||!0===this.forceRec){let t=this.items[e].getBoundingClientRect();this.matrix[e]={x:t.left+this.offset.x,y:t.top+this.offset.y}}o=this.matrix[e],(this.rows>1&&t||"auto"===t)&&(s.style.cssText+=";top:"+o.y+"px;"),(this.cols>1&&t||"auto"===t)&&(s.style.cssText+=";left:"+o.x+"px;")}if(this.onChange&&this.onChange(t),this.onHover&&t&&(this.hoverTimer=window.setTimeout(()=>{this.onHover(t)},this.hoverDelay)),this.hoverClass&&t!=P){let e=this.previousElement;e&&n(e,this.hoverClass),i(this.selectedElement,this.hoverClass)}}}addIntoBox(e){return e&&(this.name=e),F.addGrid(this),this}jumpToBox(e,t){-1===e?F.jumpBack():F.jumpTo(e,t)}keyHandler(e){if(0!==this.length){const t=e.keyCode||e.which,n=this.keyMap[t];if(n&&n in u)if(n===u.ok)this.onOk&&this.onOk.call(this);else{const e=this.cols,t=this.rows;if(n===u.left&&this.selectedIndex%e==0||n===u.right&&(this.selectedIndex+1)%e==0||n===u.up&&this.selectedIndex<e||n===u.down&&this.selectedIndex+e+1>Math.min(t*e,this.length))this.overRange(n);else{let t=n===u.left?-1:n===u.right?1:n===u.up?-e:e;this.setIndex(this.selectedIndex+t,n)}}}}extra(e){void 0===this.ex&&(this.ex={});for(let t in e)void 0===this.ex[t]&&(this.ex[t]=e[t]);return this}overRange(e){if(this.edgeRule[e]!==M)switch(e){case H:case _:if(this.edgeRule[e]===k){let t=this.selectedIndex-1;this.setIndex(t<0?this.length-1:t,e)}else this.edgeRule[e].call(this,e);break;case L:case N:if(this.edgeRule[e]===k){var t=this.selectedIndex+1;this.setIndex(t>this.length-1?0:t,e)}else this.edgeRule[e].call(this,e)}}initMatrix(){let e,t=this.forceRec;if("boolean"!=typeof t&&t){if("strict"===t)if(this.length){let t=this.items[0].getBoundingClientRect();e={x:t.left+this.offset.x,y:t.top+this.offset.y,w:t.width,h:t.height}}else e={x:0,y:0,w:0,h:0};else e=t;let n=this.cols;for(let t=0,i=n*this.rows;t<i;t++){let i=t%n*e.w+e.x,o=(t/n|0)*e.h+e.y;this.matrix[t]={x:i,y:o}}this.forceRec=!1}}set elems(e){this.items=e,0===e.length?(this.frame&&(this.frame.style.visibility="hidden"),this.onNoData&&this.onNoData.call(this)):this.frame&&"hidden"===window.getComputedStyle(this.frame,null).visibility&&(this.frame.style.visibility="visible")}get length(){return this.items.length}get selectedElement(){return this.items[this.selectedIndex]}get previousElement(){return this.items[this.previousIndex]}}class F{static addGrid(...e){for(let t=0,n=e.length;t<n;t++){let n=e[t];F.gridMap[n.name]=F.boxes.length,n.boxIndex=F.boxes.length,F.boxes.push(n)}return F}static removeGrid(e){return F.currentIndex===e&&(F.current=null,F.currentIndex=-1,F.previous&&(F.jumpTo(F.previous),F.previous=null,F.previousIndex=-1)),F.boxes.splice(e,1),F}static getGrid(e){return"string"==typeof e&&null==(e=F.gridMap[e])?null:F.boxes[e]}static jumpTo(e,t){e instanceof A?e=e.boxIndex:"string"==typeof e&&void 0===(e=F.gridMap[e])&&(e=F.currentIndex),-1===e&&(e=F.previousIndex);let n=F.boxes[e];F.current!=n&&n.length&&(F.current&&(F.current.blur(),F.previous=F.current,F.previousIndex=F.currentIndex),F.current=n,F.currentIndex=e,null!=t&&F.current.setIndex(t,"sync"),n.focus()),t&&F.current.setIndex(t,"sync")}static jumpBack(){F.jumpTo(F.previousIndex)}static keyHolder(e){F.enable&&-1!=F.currentIndex&&F.current.keyHandler(e)}static active(e){return-1===F.currentIndex&&F.boxes.length&&F.jumpTo(0),F.eventName=e||F.eventName,a(F.eventName,F.keyHolder),F}static inactive(){document.removeEventListener(F.eventName,F.keyHolder)}static reset(e,t,n){e&&F.current&&F.current.blur(),F.current=F.previous=null,F.currentIndex=F.previousIndex=-1,void 0!==t&&F.jumpTo(t,n)}}function z(e){for(let t in e){let n=e[t];T.String(n)?e[t]=S(n):T.PlainObject(n)&&z(n)}return e}F.boxes=[],F.current=null,F.previous=null,F.currentIndex=-1,F.previousIndex=-1,F.enable=!0,F.eventName="keydown",F.gridMap={};const q={};function $(e,t){let n,i,o,s,r,l,a=e.id||(e.id="ui_"+y(),e.id);if(T.Array(t)){if(!q[a])throw new Error("bind list cache not init yet");n=q[a],o=t,s=n.itemRender,r=n.itemFilter,l=n.mode}else{let e=t;i=e.template,n=q[a]&&q[a].template===i?q[a]:function(e,t){let n=t.template||"";const i=t.nullShown||"",o=n.match(/\${[\w|.]+(:=)+\w+}/g);let s='row[":index"]=i; ',r="delete row[':index']; delete row[':rowNum']; ";if(o)for(let e=0;e<o.length;e++){let t=o[e].substr(2,o[e].length-3),n=t.indexOf(":="),i=t.substr(0,n),l=i.split(".").join("']['"),a=t.substr(n+2),h=l+":="+a;s+="row['"+h+"']=scope['"+a+"'](row['"+l+"'] , i , row ,'"+i+"') ;",r+="delete row['"+h+"']; "}s+="var out='"+n.replace(/\${([\w|.]*[:]*[=]*\w+)\}(?!})/g,(function(e,t,n){let o=t.split(".").join("']['");return"'+( row['"+o+"']===null||row['"+o+"']===undefined ?'"+i+"': row['"+o+"'])+'"}))+"'; "+r+"return out;";let l={template:n,__render__:new Function("row","i","scope",s),mode:t.mode||"",itemRender:t.itemRender,itemFilter:t.itemFilter,joiner:t.joiner||"",onBound:t.onBound};return q[e]=l,l}(a,e),o=e.list||[],s=n.itemRender,r=n.itemFilter,l=n.mode}let h,c=s||window,u=[],d=0,p="function"==typeof r;for(let e=0,t=o.length;e<t;e++)h=o[e],p&&(h=r(h,e)),h&&(z(h),h[":rowNum"]=++d,u[e]=n.__render__(h,e,c));e.innerHTML=u.join(n.joiner),"function"==typeof n.onBound&&n.onBound.call(e,o,t)}function G(e,t,n){let i=e.length,o=t+n>i?i%n:n;return e.slice(t,t+o)}class U{constructor(e){this.notPaged=!0,this.container=e.container,this.pageDiv=e.pageDiv,this.template=e.template,this.itemRender=e.itemRender,this.itemFilter=e.itemFilter,this.pageSize=e.pageSize||5,this.pagination=e.pagination,this.onNoData=e.onNoData,this.onSinglePage=e.onSinglePage,this.onBound=e.onBound,this.reBind(e)}reBind(e){if(this.data=e.data,this.data){this.length=e.data.length;var t=e.pageIndex||0;this.pageCount=Math.ceil(this.length/this.pageSize),this.pageIndex=Math.min(this.pageCount-1,t),1===this.pageCount&&this?.onSinglePage(),this.length?(this.bindPage(),this?.onBound()):(this.container.innerHTML="",this?.onNoData())}}getSelectedItem(e){return this.data[this.pageIndex*this.pageSize+e]}bindPage(){let e=this.pageIndex*this.pageSize;return $(this.container,{template:this.template,itemRender:this.itemRender,itemFilter:this.itemFilter,list:G(this.data,e,this.pageSize)}),this.pageDiv&&this.notPaged&&(delete this.notPaged,this.pageDiv.style.cssText+=";display:block;",this.pagination?"function"==typeof this.pagination?this.pageDiv.innerHTML=this.pagination.call(this,this.pageIndex+1,this.pageCount,this.length):this.pageDiv.innerHTML=C(this.pagination,{pageIndex:this.pageIndex+1,pageCount:this.pageCount,rows:this.length}):this.pageDiv.innerText=this.pageIndex+1+"/"+this.pageCount+" "+unescape("%u9875")),this}turnPage(e){this.pageIndex=e>0?this.pageIndex+e>=this.pageCount?0:this.pageIndex+e:this.pageIndex-e<0?this.pageCount-1:this.pageIndex-e,this.bindPage()}gotoPage(e){e>this.pageCount-1?e=this.pageCount-1:e<0&&(e=0),this.pageIndex=e,this.bindPage()}nextPage(){this.pageIndex=this.pageIndex+1===this.pageCount?0:this.pageIndex+1,this.bindPage()}prevPage(){this.pageIndex=0===this.pageIndex?this.pageCount-1:this.pageIndex-1,this.bindPage()}}return{bindList:$,getJSON:function(e){return new Promise((function(t,n){let i=new XMLHttpRequest,o=e.url;if("GET"===e.method){let t=e.params;t&&"object"==typeof t&&(t=Object.keys(t).map((function(e){return`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`})).join("&")),o+="?"+t}i.open(e.method,o),i.timeout=3e4,i.onload=function(){this.status>=200&&this.status<300?t(JSON.parse(i.response)):n({status:this.status,statusText:i.statusText})},i.ontimeout=function(){n({message:"Timed out"})},i.onerror=function(){n({status:this.status,statusText:i.statusText})},i.setRequestHeader("Content-Type","application/json"),e.headers&&Object.keys(e.headers).forEach((function(t){i.setRequestHeader(t,e.headers[t])}));const s="GET"!=e.method&&e.params?JSON.stringify(e.params):null;i.send(s)}))},dom:c,utils:B,Consts:m,log:{active:function(e){if(e){let e=document.getElementById("divScreenLog");e||(e=document.createElement("div"),e.id="divScreenLog",e.style.cssText+="position: absolute;\n                z-index: 99999;\n                top: 80px;\n                right: 80px;\n                opacity: 0.80;\n                background: #000;\n                color: #fff;\n                font-size: 16px;",document.body.appendChild(e)),window.console.log=function(...t){e.scrollHeight>600?e.innerHTML="":e.innerHTML+="<hr>";for(var n=0,i=t.length;n<i;n++)e.innerHTML+=t[n]+"<hr>"},window.console.warn=function(...t){e.scrollHeight>600?e.innerHTML="":e.innerHTML+="<hr>";for(var n=0,i=t.length;n<i;n++)e.innerHTML+=`<span style="color:orange;font-size: 16px;">${t[n]}</span><hr>`},window.console.error=function(...t){e.scrollHeight>600?e.innerHTML="":e.innerHTML+="<hr>";for(var n=0,i=t.length;n<i;n++)e.innerHTML+=`<span style="color:red;font-size: 16px;">${t[n]}</span><hr>`},window.console.clear=function(){e.innerHTML=""}}}},grid:function(e,t){return new A(e,t)},box:F,pageList:function(e){return new U(e)}}}();
